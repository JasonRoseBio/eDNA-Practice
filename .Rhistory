DimPlot(combined, reduction = "tsne", label = TRUE, pt.size = 1, text.scale = 1.5)
DimPlot(combined, reduction = "tsne", label = TRUE, pt.size = 1)
DimPlot(combined, reduction = "tsne", label = TRUE, pt.size = 1) + NoLegend()
marker_table -< read_excel("/Users/jay/Desktop/BF550/Project2/cell_type.xlsx")
marker_table <- read_excel("/Users/jay/Desktop/BF550/Project2/cell_type.xlsx")
?readxl
marker_table <- read_xlsx("/Users/jay/Desktop/BF550/Project2/cell_type.xlsx")
library(readxl)
marker_table <- read_xlsx("/Users/jay/Desktop/BF550/Project2/cell_type.xlsx")
View(marker_table)
colnames(marker_table) <- marker_table[2, ]
View(marker_table)
marker_table <- read_xlsx("/Users/jay/Desktop/BF550/Project2/cell_type.xlsx")
colnames(marker_table) <- marker_table[1, ]
View(marker_table)
marker_table <- marker_table[-2, ]
View(marker_table)
marker_table <- read_xlsx("/Users/jay/Desktop/BF550/Project2/cell_type.xlsx")
colnames(marker_table) <- marker_table[1, ]
marker_table <- marker_table[-1, ]
View(marker_table)
head(marker_table)
View(cluster2.markers)
combined.markers <- FindAllMarkers(combined, only.pos = TRUE)
combined.markers %>%
group_by(cluster) %>%
dplyr::filter(avg_log2FC > 1)
library(dplyr)
combined.markers %>%
group_by(cluster) %>%
dplyr::filter(avg_log2FC > 1)
View(combined.markers)
View(combined.markers)
View(marker_table)
View(combined.markers)
View(marker_table)
View(combined.markers)
head(marker_table)
View(marker_table)
cell_type_table <- table(combined$sample_id, combined$cell_type)
colnames(combined@meta.data)
head(combined@meta.data)
cell_type_table <- table(combined$orig.ident, combined$cell_type)
colnames(combined@meta.data)
cell_type_table <- table(combined$orig.ident, combined$seurat_clusters)
print(cell_type_table)
cell_type_table <- data.frame(combined$orig.ident, combined$seurat_clusters)
View(cell_type_table)
cell_type_table <- table(combined$orig.ident, combined$seurat_clusters)
cell_type_df <- as.data.frame.matrix(cell_type_table)
colnames(cell_type_df) <- levels(combined$seurat_clusters)
View(cell_type_df)
library(ggplot2)
ggplot(cell_type_df, aes(x = rownames(cell_type_df))) +
geom_bar(aes(y = `Cell Type 1`, fill = `Cell Type 1`), stat = "identity", position = "stack") +
geom_bar(aes(y = `Cell Type 2`, fill = `Cell Type 2`), stat = "identity", position = "stack") +
# Repeat the above line for each cell type
labs(title = "Cell-Type Composition by Sample", x = "Sample", y = "Cell Count") +
theme_minimal()
View(cell_type_df)
ggplot(cell_type_df, aes(x = rownames(cell_type_df))) +
geom_bar(aes(y = `0`, fill = `0`), stat = "identity", position = "stack") +
geom_bar(aes(y = `1`, fill = `1`), stat = "identity", position = "stack") +
# Repeat the above line for each cell type
labs(title = "Cell-Type Composition by Sample", x = "Sample", y = "Cell Count") +
theme_minimal()
colnames(cell_type_df) <- new.cluster.ids
View(cell_type_df)
cell_type_df$Combined_Endothelial_Cells <- cell_type_df$`Endothelial Cells` + cell_type_df$`Endothelial Cells.1`
View(cell_type_df)
head(cell_type_df)
cell_type_df$`Endothelial Cells` <- paste(cell_type_df$`Endothelial Cells.1`)
cell_type_table <- table(combined$orig.ident, combined$seurat_clusters)
cell_type_df <- as.data.frame.matrix(cell_type_table)
colnames(cell_type_df) <- new.cluster.ids
colnames(cell_type_df) <- levels(combined$seurat_clusters)
colnames(cell_type_df) <- new.cluster.ids
cell_type_df$`Endothelial Cells` <- paste(cell_type_df$`Endothelial Cells.1`)
cell_type_df$Endothelial Cells <- paste(cell_type_df$Endothelial Cells.1)
colnames(cell_type_df)
colnames(cell_type_df) <- new.cluster.ids
ggplot(cell_type_df, aes(x = rownames(cell_type_df))) +
geom_bar(aes(y = `0`, fill = `0`), stat = "identity", position = "stack") +
geom_bar(aes(y = `1`, fill = `1`), stat = "identity", position = "stack") +
# Repeat the above line for each cell type
labs(title = "Cell-Type Composition by Sample", x = "Sample", y = "Cell Count") +
theme_minimal()
ggplot(cell_type_df, aes(x = rownames(cell_type_df))) +
geom_bar(aes(y = `Endothelial Cells`, fill = `Endothelial Cells`), stat = "identity", position = "stack") +
geom_bar(aes(y = `LUM + FAP Cells`, fill = `LUM + FAP Cells`), stat = "identity", position = "stack") +
# Repeat the above line for each cell type
labs(title = "Cell-Type Composition by Sample", x = "Sample", y = "Cell Count") +
theme_minimal()
cell_type_df[,1] <- paste(cell_type_df[,2])
View(cell_type_df)
cell_type_table <- table(combined$orig.ident, combined$seurat_clusters)
cell_type_df <- as.data.frame.matrix(cell_type_table)
colnames(cell_type_df) <- new.cluster.ids
cell_type_df[,1] <- paste(cell_type_df[,1], cell_type_df[,2])
library(tidyverse)
?unite()
cell_type_table <- table(combined$orig.ident, combined$seurat_clusters)
cell_type_df <- as.data.frame.matrix(cell_type_table)
colnames(cell_type_df) <- new.cluster.ids
cell_type_df %>% unite("Endothelial Cells", cell_type_df[,1]:cell_type_df[,2])
View(cell_type_df)
cell_type_df[,1] <- cell_type_df[,1] + cell_type_df[,2]
cell_type_df <- cell_type_df[ -c(2)]
ggplot(cell_type_df, aes(x = rownames(cell_type_df))) +
geom_bar(aes(y = "Endothelial Cells", fill = "Endothelial Cells"), stat = "identity", position = "stack") +
geom_bar(aes(y = `LUM + FAP Cells`, fill = `LUM + FAP Cells`), stat = "identity", position = "stack") +
geom_bar(aes(y = `Satellite Cells`, fill = `Satellite Cells`), stat = "identity", position = "stack") +
labs(title = "Cell-Type Composition by Sample", x = "Sample", y = "Cell Count") +
theme_minimal()
ggplot(cell_type_df, aes(x = rownames(cell_type_df))) +
geom_bar(aes(y = "Endothelial Cells", fill = "Endothelial Cells"), stat = "identity", position = "stack")
labs(title = "Cell-Type Composition by Sample", x = "Sample", y = "Cell Count") +
theme_minimal()
ggplot(cell_type_df, aes(x = rownames(cell_type_df))) +
geom_bar(aes(y = "Endothelial Cells", fill = "Endothelial Cells"), stat = "identity", position = "stack") +
geom_bar(aes(y = "LUM + FAP Cells", fill = "LUM + FAP Cells"), stat = "identity", position = "stack") +
geom_bar(aes(y = "Satellite Cells", fill = "Satellite Cells"), stat = "identity", position = "stack") +
geom_bar(aes(y = "Pericytes", fill = "Pericytes"), stat = "identity", position = "stack") +
geom_bar(aes(y = "FBN1+ FAP Cells", fill = "FBN1+ FAP Cells"), stat = "identity", position = "stack") +
geom_bar(aes(y = "NK Cells", fill = "NK Cells"), stat = "identity", position = "stack") +
geom_bar(aes(y = "PCV Endothelial Cells", fill = "PCV Endothelial Cells"), stat = "identity", position = "stack") +
geom_bar(aes(y = "T and B Cells", fill = "T and B Cells"), stat = "identity", position = "stack") +
geom_bar(aes(y = "Smooth Muscle Cells", fill = "Smooth Muscle Cells"), stat = "identity", position = "stack") +
geom_bar(aes(y = "Myeloid Cells", fill = "Myeloid Cells"), stat = "identity", position = "stack") +
labs(title = "Cell-Type Composition by Sample", x = "Sample", y = "Cell Count") +
theme_minimal()
ggplot(cell_type_df, aes(x = Combined_Endothelial_Cells, y = rownames(cell_type_df))) +
geom_col(aes(fill = Combined_Endothelial_Cells), position = "stack") +
labs(title = "Cell-Type Composition by Sample", x = "Cell Count", y = "Sample") +
theme_minimal()
ggplot(cell_type_df, aes(x = rownames(cell_type_df))) +
geom_col(aes(y = `Endothelial Cells`, fill = `Endothelial Cells`), position = "stack") +
geom_col(aes(y = `LUM + FAP Cells`, fill = `LUM + FAP Cells`), position = "stack") +
geom_col(aes(y = `Satellite Cells`, fill = `Satellite Cells`), position = "stack") +
geom_col(aes(y = `Pericytes`, fill = `Pericytes`), position = "stack") +
geom_col(aes(y = `FBN1+ FAP Cells`, fill = `FBN1+ FAP Cells`), position = "stack") +
geom_col(aes(y = `NK Cells`, fill = `NK Cells`), position = "stack") +
geom_col(aes(y = `PCV Endothelial Cells`, fill = `PCV Endothelial Cells`), position = "stack") +
geom_col(aes(y = `T and B Cells`, fill = `T and B Cells`), position = "stack") +
geom_col(aes(y = `Smooth Muscle Cells`, fill = `Smooth Muscle Cells`), position = "stack") +
geom_col(aes(y = `Myeloid Cells`, fill = `Myeloid Cells`), position = "stack") +
labs(title = "Cell-Type Composition by Sample", x = "Sample", y = "Cell Count") +
theme_minimal()
ggplot(cell_type_df, aes(y = rownames(cell_type_df))) +
geom_col(aes(x = `Endothelial Cells`, fill = `Endothelial Cells`), position = "stack") +
geom_col(aes(x = `LUM + FAP Cells`, fill = `LUM + FAP Cells`), position = "stack") +
geom_col(aes(x = `Satellite Cells`, fill = `Satellite Cells`), position = "stack") +
geom_col(aes(x = `Pericytes`, fill = `Pericytes`), position = "stack") +
geom_col(aes(x = `FBN1+ FAP Cells`, fill = `FBN1+ FAP Cells`), position = "stack") +
geom_col(aes(x = `NK Cells`, fill = `NK Cells`), position = "stack") +
geom_col(aes(x = `PCV Endothelial Cells`, fill = `PCV Endothelial Cells`), position = "stack") +
geom_col(aes(x = `T and B Cells`, fill = `T and B Cells`), position = "stack") +
geom_col(aes(x = `Smooth Muscle Cells`, fill = `Smooth Muscle Cells`), position = "stack") +
geom_col(aes(x = `Myeloid Cells`, fill = `Myeloid Cells`), position = "stack") +
labs(title = "Cell-Type Composition by Sample", x = "Cell Count", y = "Sample") +
theme_minimal()
ggplot(melt(cell_type_df), aes(x = variable, y = value, fill = variable)) +
geom_col(position = "dodge") +
labs(title = "Cell-Type Composition by Sample", x = "Cell Type", y = "Cell Count", fill = "Sample") +
theme_minimal()
cell_type_df_transposed <- as.data.frame(t(cell_type_df))
# Add a 'Sample' column with the sample names
cell_type_df_transposed$Sample <- rownames(cell_type_df_transposed)
# Convert the data frame to long format
cell_type_df_long <- reshape2::melt(cell_type_df_transposed, id.vars = "Sample", variable.name = "Cell_Type", value.name = "Cell_Count")
View(cell_type_df_transposed)
cell_type_df_transposed <- as.data.frame(t(cell_type_df))
cell_type_df_transposed$Sample <- rownames(cell_type_df_transposed)
cell_type_df_long <- reshape2::melt(cell_type_df_transposed, id.vars = "Sample", variable.name = "Cell_Type", value.name = "Cell_Count")
cell_type_df_transposed <- as.data.frame(t(cell_type_df))
# Add a 'Sample' column with the sample names
cell_type_df_transposed$Sample <- rownames(cell_type_df_transposed)
View(cell_type_df)
cell_type_df_transposed <- as.data.frame(t(cell_type_df))
cell_type_df %>% pivot_longer(cols=c("Endothelial Cells", "LUM + FAP Cells", "Satellite Cells", "Pericytes", "FBN1+ FAP Cells", "NK Cells", "PCV Endothelial Cells", "T and B Cells", "Smooth Muscle Cells", "Myeloid Cells"),
names_to="Cell Type",
values_to="Counts")
View(cell_type_df_long)
View(cell_type_df_transposed)
View(cell_type_df)
print(colnames(cell_type_df))
# Use pivot_longer to reshape the data
cell_type_df_long <- cell_type_df %>%
pivot_longer(cols = c("Endothelial Cells", "LUM + FAP Cells", "Satellite Cells",
"Pericytes", "FBN1+ FAP Cells", "NK Cells",
"PCV Endothelial Cells", "T and B Cells",
"Smooth Muscle Cells", "Myeloid Cells"),
names_to = "Cell Type",
values_to = "Counts")
# Print the resulting data frame
print(cell_type_df_long)
View(cell_type_df_long)
#x = cell count y =cell type
cell_type_df_transposed <- as.data.frame(t(cell_type_df))
# Add a 'Sample' column with the sample names
cell_type_df_transposed$Sample <- rownames(cell_type_df_transposed)
# Convert the data frame to long format
cell_type_df_long <- reshape2::melt(cell_type_df_transposed, id.vars = "Sample", variable.name = "Cell_Type", value.name = "Cell_Count")
View(cell_type_df_long)
cell_type_df_long <- reshape2::melt(cell_type_df_transposed, id.vars = "Cell Type", variable.name = "Sample", value.name = "Cell Count")
cell_type_df_transposed <- as.data.frame(t(cell_type_df))
# Add a 'Sample' column with the sample names
cell_type_df_transposed$Sample <- rownames(cell_type_df_transposed)
# Convert the data frame to long format
cell_type_df_long <- reshape2::melt(cell_type_df_transposed, id.vars = "Cell Type", variable.name = "Sample", value.name = "Cell Count")
cell_type_table <- table(combined$orig.ident, combined$seurat_clusters)
cell_type_df <- as.data.frame.matrix(cell_type_table)
#Uses column names for cell-type from previous markdown block to assign their names to the respective columns in this new df
colnames(cell_type_df) <- new.cluster.ids
#As the first two clusters are considered 1, this code adds their values. The next line removes the extra column
cell_type_df[,1] <- cell_type_df[,1] + cell_type_df[,2]
cell_type_df <- cell_type_df[ -c(2)]
View(cell_type_df)
#x = cell count y =cell type
cell_type_df_transposed <- as.data.frame(t(cell_type_df))
# Add a 'Sample' column with the sample names
cell_type_df_transposed$Sample <- rownames(cell_type_df_transposed)
View(cell_type_df_transposed)
cell_type_df_transposed$Cell Type <- rownames(cell_type_df_transposed)
cell_type_df_transposed$Cell_type <- rownames(cell_type_df_transposed)
View(cell_type_df_transposed)
cell_type_df_transposed <- as.data.frame(t(cell_type_df))
# Add a 'Sample' column with the sample names
cell_type_df_transposed$Cell_type <- rownames(cell_type_df_transposed)
View(cell_type_df_transposed)
cell_type_df_long <- reshape2::melt(cell_type_df_transposed, id.vars = "Cell_type", variable.name = "Sample", value.name = "Cell Count")
ggplot(data=df2, aes(x = Cell Count, y = Cell_type, fill = Sample)) +
ggplot(data=cell_type_df_long, aes(x = Cell Count, y = Cell_type, fill = Sample)) +
cell_type_df_transposed <- as.data.frame(t(cell_type_df))
# Add a 'Sample' column with the sample names
cell_type_df_transposed$Cell_type <- rownames(cell_type_df_transposed)
# Convert the data frame to long format
cell_type_df_long <- reshape2::melt(cell_type_df_transposed, id.vars = "Cell_type", variable.name = "Sample", value.name = "Cell_count")
ggplot(data=cell_type_df_long, aes(x = Cell_count, y = Cell_type, fill = Sample)) +
geom_bar(stat="identity")
View(cell_type_df)
cell_type_table <- table(combined$orig.ident, combined$seurat_clusters)
cell_type_df <- as.data.frame.matrix(cell_type_table)
#Uses column names for cell-type from previous markdown block to assign their names to the respective columns in this new df
colnames(cell_type_df) <- new.cluster.ids
rownames(cell_type_df) <- c("Sample 1","Sample 2","Sample 3","Sample 4")
#As the first two clusters are considered 1, this code adds their values. The next line removes the extra column
View(cell_type_df)
cell_type_df[,1] <- cell_type_df[,1] + cell_type_df[,2]
cell_type_df <- cell_type_df[ -c(2)]
#Transform data into long format
#x = cell count y =cell type
cell_type_df_transposed <- as.data.frame(t(cell_type_df))
# Add a 'Sample' column with the sample names
cell_type_df_transposed$Cell_type <- rownames(cell_type_df_transposed)
# Convert the data frame to long format
cell_type_df_long <- reshape2::melt(cell_type_df_transposed, id.vars = "Cell_type", variable.name = "Sample", value.name = "Cell_count")
ggplot(data=cell_type_df_long, aes(x = Cell_count, y = Cell_type, fill = Sample)) +
geom_bar(stat="identity")
ggplot(data=cell_type_df_long, aes(x = reorder(Cell_count), y = Cell_type, fill = Sample)) +
geom_bar(stat="identity")
ggplot(data=cell_type_df_long, aes(x = reorder(Cell_count, -Cell_type), y = Cell_type, fill = Sample)) +
geom_bar(stat="identity")
?reorder()
ggplot(data=cell_type_df_long, aes(x = reorder(Cell_count),
y = Cell_type, fill = Sample)) +
geom_bar(stat="identity")
ggplot(data=cell_type_df_long, aes(x = Cell_count, y = reorder(Cell_type), fill = Sample)) +
geom_bar(stat="identity")
ggplot(data=cell_type_df_long, aes(x = Cell_count, y = reorder(Cell_type, -Cell_count), fill = Sample)) +
geom_bar(stat="identity")
ggplot(data=cell_type_df_long, aes(x = Cell_count, y = reorder(Cell_type, -Cell_count), fill = Sample)) +
geom_bar(stat="identity") +
labs(title = "Cell Type Composition",
x = "Cell Count", y = "Cell Type")
ggplot(data=cell_type_df_long, aes(x = Cell_count, y = reorder(Cell_type, -Cell_count), fill = Sample)) +
geom_bar(stat="identity") +
labs(title = "Cell Type Composition of Samples",
x = "Cell Count", y = "Cell Type")
DimPlot(combined, reduction = "tsne", label = TRUE, pt.size = 1) + NoLegend()
View(combined.markers)
View(marker_table)
View(marker_table)
library(Seurat)
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyverse)
#Importing counts data and assigning the first
sample1 <- read.csv("/Users/jay/Desktop/BF550/Project2/skel_m_data/GSM3746212_Muscle_1_Counts.csv", row.names = 1)
sample2 <- read.csv("/Users/jay/Desktop/BF550/Project2/skel_m_data/GSM3746213_Muscle_2_Counts.csv.gz", row.names = 1)
sample3 <- read.csv("/Users/jay/Desktop/BF550/Project2/skel_m_data/GSM3746214_Muscle_3_Counts.csv.gz", row.names = 1)
sample4 <- read.csv("/Users/jay/Desktop/BF550/Project2/skel_m_data/GSM3746215_Muscle_4_Counts.csv.gz", row.names = 1)
#importing cell type table (s1 table) for cell type analysis
marker_table <- read_xlsx("/Users/jay/Desktop/BF550/Project2/cell_type.xlsx")
colnames(marker_table) <- marker_table[1, ]
marker_table <- marker_table[-1, ]
#Creating seurat objects of all four samples. Required step to use seurat for umap/tsne analysis
x1_obj <- CreateSeuratObject(counts = sample1, project = "skel_1")
x2_obj <- CreateSeuratObject(counts = sample2, project = "skel_2")
x3_obj <- CreateSeuratObject(counts = sample3, project = "skel_3")
x4_obj <- CreateSeuratObject(counts = sample4, project = "skel_4")
#Creating a new column in regards to mitochondrial DNA to be used in the next step to verify data downloaded from GEO
x1_obj[["percent.mt"]] <- PercentageFeatureSet(x1_obj, pattern = "^MT-")
x2_obj[["percent.mt"]] <- PercentageFeatureSet(x2_obj, pattern = "^MT-")
x3_obj[["percent.mt"]] <- PercentageFeatureSet(x3_obj, pattern = "^MT-")
x4_obj[["percent.mt"]] <- PercentageFeatureSet(x4_obj, pattern = "^MT-")
#Creating violin plot to paper sup. material to confirm the data was pre-filtered and no further filtration is required
VlnPlot(x1_obj, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
VlnPlot(x2_obj, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
VlnPlot(x3_obj, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
VlnPlot(x4_obj, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
#Merging the seurat objects into one as the paper had done
combined <- merge(x1_obj, y = c(x2_obj, x3_obj, x4_obj), project = "proj2")
#Log normalizing the data with a scale factor of 10,000, both default parameters by the Seurat package
combined <- NormalizeData(combined)
#finding highly variable features in the data-set using variance stabilizing transformation as the default method of finding the genes. By default, the top 2000 genes are selected.
combined <- FindVariableFeatures(combined)
#
combined <- ScaleData(combined)
combined <- RunPCA(combined, features = VariableFeatures(object = combined))
combined <- FindNeighbors(combined, dims = 1:10)
combined <- FindClusters(combined, reduction.name = "pca", resolution = 0.5)
#Finding cell markers using seurat. The results were not similar to what the paper provided with their supplimentary table (their exact methods were not provided), but this was how they did that analysis.
combined <- JoinLayers(combined)
combined.markers <- FindAllMarkers(combined, only.pos = TRUE)
combined.markers %>%
group_by(cluster) %>%
dplyr::filter(avg_log2FC > 1)
#Assigning the cell type names to the clusters
new.cluster.ids <- c("Endothelial Cells", "Endothelial Cells", "LUM + FAP Cells", "Satellite Cells", "Pericytes", "FBN1+ FAP Cells", "NK Cells", "PCV Endothelial Cells", "T and B Cells", "Smooth Muscle Cells", "Myeloid Cells")
names(new.cluster.ids) <- levels(combined)
names(new.cluster.ids) <- levels(combined)
combined <- RunTSNE(combined, dims = 1:10)
names(new.cluster.ids) <- levels(combined)
length(new.cluster.ids)
length(levels(combined))
any(is.na(new.cluster.ids))
any(is.na(levels(combined)))
length(unique(names(new.cluster.ids)))
# Assuming 'combined' is a factor variable
levels(combined)
DimPlot(combined, reduction = "tsne", label = TRUE, pt.size = 1) + NoLegend()
combined <- FindClusters(combined, reduction.name = "pca", resolution = 1.2)
new.cluster.ids <- c("Endothelial Cells", "Endothelial Cells", "LUM + FAP Cells", "Satellite Cells", "Pericytes", "FBN1+ FAP Cells", "NK Cells", "PCV Endothelial Cells", "T and B Cells", "Smooth Muscle Cells", "Myeloid Cells")
names(new.cluster.ids) <- levels(combined)
new.cluster.ids <- c("Endothelial Cells", "Endothelial Cells", "LUM + FAP Cells", "Satellite Cells", "Pericytes", "FBN1+ FAP Cells", "NK Cells", "PCV Endothelial Cells", "T and B Cells", "Smooth Muscle Cells", "Myeloid Cells")
names(new.cluster.ids) <- levels(combined)
combined <- FindClusters(combined, reduction.name = "pca", resolution = 0.5)
names(new.cluster.ids) <- levels(combined)
combined <- FindNeighbors(combined, dims = 1:10)
combined <- FindClusters(combined, reduction.name = "pca", resolution = 0.5)
sample1 <- read.csv("/Users/jay/Desktop/BF550/Project2/skel_m_data/GSM3746212_Muscle_1_Counts.csv", row.names = 1)
sample2 <- read.csv("/Users/jay/Desktop/BF550/Project2/skel_m_data/GSM3746213_Muscle_2_Counts.csv.gz", row.names = 1)
sample3 <- read.csv("/Users/jay/Desktop/BF550/Project2/skel_m_data/GSM3746214_Muscle_3_Counts.csv.gz", row.names = 1)
sample4 <- read.csv("/Users/jay/Desktop/BF550/Project2/skel_m_data/GSM3746215_Muscle_4_Counts.csv.gz", row.names = 1)
#importing cell type table (s1 table) for cell type analysis
marker_table <- read_xlsx("/Users/jay/Desktop/BF550/Project2/cell_type.xlsx")
colnames(marker_table) <- marker_table[1, ]
marker_table <- marker_table[-1, ]
#Creating seurat objects of all four samples. Required step to use seurat for umap/tsne analysis
x1_obj <- CreateSeuratObject(counts = sample1, project = "skel_1")
x2_obj <- CreateSeuratObject(counts = sample2, project = "skel_2")
x3_obj <- CreateSeuratObject(counts = sample3, project = "skel_3")
x4_obj <- CreateSeuratObject(counts = sample4, project = "skel_4")
combined <- merge(x1_obj, y = c(x2_obj, x3_obj, x4_obj), project = "proj2")
#Log normalizing the data with a scale factor of 10,000, both default parameters by the Seurat package
combined <- NormalizeData(combined)
#finding highly variable features in the data-set using variance stabilizing transformation as the default method of finding the genes. By default, the top 2000 genes are selected.
combined <- FindVariableFeatures(combined)
combined <- ScaleData(combined)
combined <- RunPCA(combined, features = VariableFeatures(object = combined))
combined <- FindNeighbors(combined, dims = 1:10)
combined <- FindClusters(combined, reduction.name = "pca", resolution = 0.5)
names(new.cluster.ids) <- levels(combined)
combined <- RenameIdents(combined, new.cluster.ids)
new.cluster.ids <- c("Endothelial Cells", "Endothelial Cells", "LUM + FAP Cells", "Satellite Cells", "Pericytes", "FBN1+ FAP Cells", "NK Cells", "PCV Endothelial Cells", "T and B Cells", "Smooth Muscle Cells", "Myeloid Cells")
names(new.cluster.ids) <- levels(combined)
combined <- RunTSNE(combined, dims = 1:10)
DimPlot(combined, reduction = "tsne", label = TRUE, pt.size = 1) + NoLegend()
combined <- FindNeighbors(combined, dims = 1:9)
combined <- FindClusters(combined, reduction.name = "pca", resolution = 0.5)
names(new.cluster.ids) <- levels(combined)
combined <- FindNeighbors(combined, dims = 1:8)
combined <- FindClusters(combined, reduction.name = "pca", resolution = 0.5)
names(new.cluster.ids) <- levels(combined)
combined <- RenameIdents(combined, new.cluster.ids)
combined <- RunTSNE(combined, dims = 1:10)
DimPlot(combined, reduction = "tsne", label = TRUE, pt.size = 1) + NoLegend()
#Finding cell markers using seurat. The results were not similar to what the paper provided with their supplimentary table (their exact methods were not provided), but this was how they did that analysis.
combined <- JoinLayers(combined)
combined.markers <- FindAllMarkers(combined, only.pos = TRUE)
combined.markers %>%
group_by(cluster) %>%
dplyr::filter(avg_log2FC > 1)
?help
library(Seurat)
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyverse)
#Importing counts data and assigning the first
sample1 <- read.csv("/Users/jay/Desktop/BF550/Project2/skel_m_data/GSM3746212_Muscle_1_Counts.csv", row.names = 1)
sample2 <- read.csv("/Users/jay/Desktop/BF550/Project2/skel_m_data/GSM3746213_Muscle_2_Counts.csv.gz", row.names = 1)
sample3 <- read.csv("/Users/jay/Desktop/BF550/Project2/skel_m_data/GSM3746214_Muscle_3_Counts.csv.gz", row.names = 1)
sample4 <- read.csv("/Users/jay/Desktop/BF550/Project2/skel_m_data/GSM3746215_Muscle_4_Counts.csv.gz", row.names = 1)
#importing cell type table (s1 table) for cell type analysis
marker_table <- read_xlsx("/Users/jay/Desktop/BF550/Project2/cell_type.xlsx")
colnames(marker_table) <- marker_table[1, ]
marker_table <- marker_table[-1, ]
#Creating seurat objects of all four samples. Required step to use seurat for umap/tsne analysis
x1_obj <- CreateSeuratObject(counts = sample1, project = "skel_1")
x2_obj <- CreateSeuratObject(counts = sample2, project = "skel_2")
x3_obj <- CreateSeuratObject(counts = sample3, project = "skel_3")
x4_obj <- CreateSeuratObject(counts = sample4, project = "skel_4")
#Creating a new column in regards to mitochondrial DNA to be used in the next step to verify data downloaded from GEO
x1_obj[["percent.mt"]] <- PercentageFeatureSet(x1_obj, pattern = "^MT-")
x2_obj[["percent.mt"]] <- PercentageFeatureSet(x2_obj, pattern = "^MT-")
x3_obj[["percent.mt"]] <- PercentageFeatureSet(x3_obj, pattern = "^MT-")
x4_obj[["percent.mt"]] <- PercentageFeatureSet(x4_obj, pattern = "^MT-")
#Creating violin plot to paper sup. material to confirm the data was pre-filtered and no further filtration is required
VlnPlot(x1_obj, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
VlnPlot(x2_obj, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
VlnPlot(x3_obj, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
VlnPlot(x4_obj, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
#Merging the seurat objects into one as the paper had done
combined <- merge(x1_obj, y = c(x2_obj, x3_obj, x4_obj), project = "proj2")
#Log normalizing the data with a scale factor of 10,000, both default parameters by the Seurat package
combined <- NormalizeData(combined)
#finding highly variable features in the data-set using variance stabilizing transformation as the default method of finding the genes, scaling the data, then running principle component analysis reduction. By default, the top 2000 genes are selected.
combined <- FindVariableFeatures(combined)
combined <- ScaleData(combined)
combined <- RunPCA(combined, features = VariableFeatures(object = combined))
#For some reason, I had dims set = 1:10 previously to attain the right amount of clusters. Upon re-running the code the next day, I was unable to get those same results and had to lower it to 1:8
combined <- FindNeighbors(combined, dims = 1:8)
combined <- FindClusters(combined, reduction.name = "pca", resolution = 0.5)
#Assigning the cell type names to the clusters
new.cluster.ids <- c("Endothelial Cells", "Endothelial Cells", "LUM + FAP Cells", "Satellite Cells", "Pericytes", "PRG4+ FAP Cells", "NK Cells", "PCV Endothelial Cells", "T and B Cells", "Smooth Muscle Cells", "Myeloid Cells")
names(new.cluster.ids) <- levels(combined)
combined <- RenameIdents(combined, new.cluster.ids)
#Running t-SNE analysis on the first 10 principle components, producing 11 clusters. The paper had seperated T and B cells, but I was unable to figure out how this was done as it related to finding cell markers
combined <- RunTSNE(combined, dims = 1:10)
DimPlot(combined, reduction = "tsne", label = TRUE, pt.size = 1) + NoLegend()
#Finding cell markers using seurat. The results were not similar to what the paper provided with their supplimentary table (their exact methods were not provided), but this was how they did that analysis. This was only used for identifying the cell type of the clusters
combined <- JoinLayers(combined)
combined.markers <- FindAllMarkers(combined, only.pos = TRUE)
combined.markers %>%
group_by(cluster) %>%
dplyr::filter(avg_log2FC > 1)
#Second plot. Creating a df from the cell-type counts for each sample
cell_type_table <- table(combined$orig.ident, combined$seurat_clusters)
cell_type_df <- as.data.frame.matrix(cell_type_table)
#Uses column names for cell-type from previous markdown block to assign their names to the respective columns in this new df
colnames(cell_type_df) <- new.cluster.ids
rownames(cell_type_df) <- c("Sample 1","Sample 2","Sample 3","Sample 4")
#As the first two clusters are considered 1, this code adds their values. The next line removes the extra column
cell_type_df[,1] <- cell_type_df[,1] + cell_type_df[,2]
cell_type_df <- cell_type_df[ -c(2)]
#Transforming data into long format
cell_type_df_transposed <- as.data.frame(t(cell_type_df))
cell_type_df_transposed$Cell_type <- rownames(cell_type_df_transposed)
cell_type_df_long <- reshape2::melt(cell_type_df_transposed, id.vars = "Cell_type", variable.name = "Sample", value.name = "Cell_count")
#Creating a bar plot of cell type composition, using ggplot2 package
ggplot(data=cell_type_df_long, aes(x = Cell_count, y = reorder(Cell_type, -Cell_count), fill = Sample)) +
geom_bar(stat="identity") +
labs(title = "Cell Type Composition of Samples",
x = "Cell Count", y = "Cell Type")
install.packages("vegan")
library(vegan)
?diversity
data(package = "vegan")
data(dune)
View(dune)
str(dune)
?str()
View(dune)
diversity(dune, index = "simpson")
View(dune)
simpson <- diversity(dune, index = "simpson")
shannon <- diversity(dune)
par(mfrow = c(1,2))
hist(simpson)
hist(shannon)
dev.off()
hist(simpson)
par(mfrow = c(1,2))
hist(simpson)
hist(shannon)
hist(shannon)
hist(simpson)
dev.off()
hist(shannon)
dev.off()
plot(1:10)
par(mfrow = c(1, 2))   # 1 row, 2 columns
hist(simpson,
main = "Simpson diversity",
col = "skyblue",
xlab = "D index")
hist(shannon,
main = "Shannon diversity",
col = "orange",
xlab = "H'")
setwd("~/Desktop/r practice/gene_reg_brain")
setwd("~/Desktop/r_practice/gene_reg_brain")
setwd("~/Desktop/eDNA_practice")
install.packages("dada2")
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("dada2", version = "3.16")
library(dada2)
library("dada2")
